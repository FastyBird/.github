name: "Coding Standard Check"

on:
  workflow_call:
    inputs:
      node:
        required: false
        type: string
        default: "20"

      yarn:
        required: false
        type: string
        default: "yarn install"

jobs:
  static-analysis:
    name: "Coding Standard (${{ inputs.node }})"
    runs-on: "${{ matrix.operating-system }}"

    strategy:
      fail-fast: false
      matrix:
        operating-system: [ "ubuntu-latest" ]

    steps:
      - name: "Checkout"
        uses: "actions/checkout@v4"

      - name: "Setup node"
        uses: "actions/setup-node@v4"
        with:
          node-version: "${{ inputs.node }}"

      - name: "Yarn"
        uses: "fastybird/.github/.github/actions/setup-yarn@main"
        with:
          command: "${{ inputs.yarn }}"

      - name: "Initialize lerna"
        run: "yarn bootstrap"

      - name: "Link JS dependencies"
        run: "yarn lerna link"

      - name: "Build JS dependencies"
        run: "yarn build"

      - name: "Check typescript"
        run: "yarn types"
